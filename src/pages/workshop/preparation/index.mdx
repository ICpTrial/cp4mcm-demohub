---
title: Environment Preparation
description: Preparing your CP4MCM environment
---

<AnchorLinks>
  <AnchorLink>Installing CLI Tools</AnchorLink>
  <AnchorLink>Accessing the Hub Cluster</AnchorLink>
  <AnchorLink>Cloning the Preparation Scripts</AnchorLink>
  <AnchorLink>Executing the Scripts</AnchorLink>
  <AnchorLink>Validating the Environment</AnchorLink>
  <AnchorLink>Sending Lab Users Email</AnchorLink>
</AnchorLinks>


***

## Installing CLI Tools

CLI tools provide the ability to manage applications, containers, infrastructures, services, and other resources. In this section you will install all the necessary CLI tool in your local machine to be able to complete the Labs.

*Note:* If you have already installed all CLIs in your local machine, you can skip this page.


<Accordion>
  <AccordionItem title="Install IBM Cloud Pak CLI (cloudctl)">

1.You should be on your CP4MCM Web Console, if not, check how to access it in [Before Start](../beforestart/) page.

  From the CP4MCM Web Console page, select the **user icon**, then click **Configure client**.

  ![](images/2-cloudpak-cli.png)

2.Click **Install CLI tools**.

  ![](images/3-cloudpak-cli.png)

3.Expand **Install IBM Cloud Pak CLI (cloudctl)**. Read the text, then copy and run the curl command for your operating system.

  ![](images/4-cloudpak-cli.png)

  ![](images/5-cloudpak-cli.png)

4.After you run the curl command for your operating system, continue to install the IBM Cloud Pak® CLI.

  To install the IBM Cloud Pak® CLI, run the command that matches your client computer operating system, where <path_to_installer> is the path to the directory where you downloaded the cloudctl file, and <install_file> is the downloaded file name.

  For example, for Linux and macOS, run the following commands to change and move the file. Remember that the curl command for your cluster is located in the console:

```
chmod 755 <path_to_installer>/<install_file>
sudo mv <path_to_installer>/<install_file> /usr/local/bin/cloudctl
```

  For Windows, rename the downloaded file to cloudctl and place the file on the PATH environment variable.

  ![](images/6-cloudpak-cli.png)

5.Confirm that cloudctl is installed:

```
cloudctl --help
```

  ![](images/7-cloudpak-cli.png)

6.Log in to your cluster with the following command:
```
cloudctl login -a <CP4MCM_Console_URL>  --skip-ssl-validation
```

  Where `CP4MCM_Console_URL` is the hostname of your CP4MCM console, something like *https://icp-console.playgroth-mcm...appdomain.cloud*

  After the command, you need to enter your CP4MCM **admin user** (1), your admin **password** (32 charecters password that you defined in the CP4MCM installation) and enter **default** as namespace.

  ![](images/7_2-cluster-mgmt-img.png)

</AccordionItem>

  <AccordionItem title="Install Kubectl CLI">

1.Let's set up the kubectl CLI. Expand Install Kubernetes CLI to download the installer by using a curl command. Copy and run the curl command for your operating system, then continue the installation procedure in the product documentation.

  ![](images/8-cloudpak-cli.png)

2.Change the file to an executable, then move the file to a directory that is included in your PATH environment variable. See the following commands where <path_to_installer> is the location of the file that you downloaded and <install_file> is the name of the file:

  For Linux and macOS, run the following commands to change the permissions of the file and move the file to a directory that is included in your PATH environment variable:

```
chmod 755 <path_to_installer>/<install_file>
sudo mv <path_to_installer>/<install_file> /usr/local/bin/kubectl
```

  For Windows, rename the downloaded file to kubectl and place the file in a directory that is listed in the PATH environment variable.
</AccordionItem>

<AccordionItem title="Install IBM Cloud CLI">
1.In this tutorial, you install the IBM Cloud CLI along with popular plug-ins and tools so you can work with Kubernete, OpenShift clusters, and more in IBM Cloud.

  You can use the Red Hat OpenShift on IBM Cloud command line interface (CLI) plug-in (ibmcloud oc) to create and manage your OpenShift cluster infrastructure, such as creating clusters and worker nodes. Then, you can use the OpenShift CLI (oc) to manage the resources within your OpenShift cluster, such as projects, pods, and deployments.

  Run the command below to install the IBM Cloud CLI.

```
curl -sL https://ibm.biz/idt-installer | bash
```

  ![](images/17-cloudpak-cli.png)

2.To verify that the CLI and Developer Tools were installed successfully, run the help command:

```
ibmcloud dev help
```

  ![](images/18-cloudpak-cli.png)

3.Log in to IBM Cloud with your IBMid using the command below to guarantee that you will select your personal account (not DTE account).

```
ibmcloud login -sso -r us-south -g default -c <your_ibm_id>
```

  Follow the URL in the prompt to get the one-time passcode. Copy and paste the passcode value in the CLI as your input.

```
ibmcloud login --sso -r us-south -g default -c <your_ibm_id>
API endpoint: https://cloud.ibm.com

Get One Time Code from https://identity-2.us-south.iam.cloud.ibm.com/identity/passcode to proceed.
Open the URL in the default browser? [Y/n]>
One Time Code >
Authenticating...
OK
```

4.To avoid the SSO extra steps, you can generate an IBM Cloud API Key. Let's do it!  Create an IBM Cloud API Key by running the follow command:

```
ibmcloud iam api-key-create myibmcloudkey --file myic.key
```

5.Let's test the new key. First logout from IBM Cloud.

```
ibmcloud logout
```

6.Now, log in using the command below:

```
ibmcloud login --apikey @myic.key -r us-south -g default -c <your_ibm_id>
```

</AccordionItem>

<AccordionItem title="Install OC CLI">

1.Now open your OpenShift console (there is a link available in email that you received from IBM Cloud, after your Environment Request).

2.On Openshift Console, open the Help menu and select the Command Line Tools link.

  ![](images/19-cloudpak-cli.png)

3.On the  OpenShift Command Line Interface section, download the OC CLI specific for your operational system.

  ![](images/20-cloudpak-cli.png)

4.If you are using Linux or macOS, run the following commands to change and move the file.

```
chmod 755 <path_to_installer>/<install_file>
sudo mv <path_to_installer>/<install_file> /usr/local/bin/cloudctl
```

5.To verify that the CLI was installed successfully, run the follow command:

```
oc get nodes
```

</AccordionItem>

<AccordionItem title="Install Git CLI">

  You will need Git CLI to clone some YAML files as part of the Application Management Lab. Follow the installation steps described in the page below [Git site](https://git-scm.com/downloads) , based in your operational system.

</AccordionItem>

<AccordionItem title="Install MC Plugin on cloudctl">
1.The mc plug-in is not in the IBM Cloud Pak CLI (cloudctl) installation. Complete the following procedure to download and install the plug-in to work with multiple clusters. Download the multicluster, or mc plug-in for the applicable operating system. See the list of the mc plug-in commands for the different operating systems:

```
curl -kLo cloudctl-mc-plugin https://<Cluster_Master_Host>:<Cluster_Master_API Port>/rcm/plugins/mc-darwin-amd64
```

  ![](images/14-cloudpak-cli.png)

  Note: You can use your CP4MCM Web Console URL on HTTPS as *Cluster Master Host*

2.Install the mc plugin for cloudctl. Run the following command to install the plug-in

```
cloudctl plugin install -f cloudctl-mc-plugin
```

  ![](images/15-cloudpak-cli.png)

3.Verify that the mc plugin for cloudctl was successfully installed. Run the following command:

```
cloudctl mc -help
```

  ![](images/16-cloudpak-cli.png)

</AccordionItem>

<AccordionItem title="Install Helm CLI">
To use the preparation script, you will need to have the Helm CLI v2. The version v2.12.3 is available <a href="https://github.com/helm/helm/releases/tag/v2.12.3" target="_blank">here</a>. Download the version of your OS and follow the installation steps described in this [page](https://helm.sh/docs/intro/quickstart/).
</AccordionItem>


</Accordion>

***

## Accessing the Hub Cluster

1.Open your Cloud Pak for Multicloud Management Web Console (if you are not there, check [here](../beforestart/) how to open your console page).

  ![](images/1-cloudpak-cli.png)

2.Select the **user icon**, then click **Configure client**.

  ![](images/2-cloudpak-cli.png)

3.The cluster configuration details display and resemble the client configuration code. Copy and paste the configuration information to your command line, and press Enter.

  ![](images/11-cloudpak-cli.png)

  ![](images/12-cloudpak-cli.png)

4.Check the Kubernetes contexts available, running the command below:

```
kubectl config get-contexts
```

  You should have a mycluster-context that point to your ROKS Hub cluster.

  ![](images/13-cloudpak-cli.png)

  Next step, you will rename this context to simplify how you interact with your ROKS Hub server during our lab.

5.Rename your context, running the command below:

```
kubectl config rename-context mycluster-context hub-cluster
```

6.Now, let's set the current Kubernetes context

```
kubectl config use-context hub-cluster
```

  >Note: Anytime that you want to connect to your Hub cluster, you just need to run the command above.

7.Let's test the new context configuration. Run the command below to get the cluster nodes.

```
oc get nodes
```

  ![](images/24-cloudpak-cli.png)

  Great, your Hub cluster is configured and ready to use.

***

## Cloning the Preparation Scripts

1.In this Workshop in a Box, you will use a Multi User architecture. One CP4MCM ROKS will be used to support multiple lab users. To simplify the process of integrate LDAP, create multiple users and other details, the DTE team created some preparation scripts. Let's clone these scripts. Open your terminal window and execute the command below.
```
git clone https://github.ibm.com/demohub/cp4mcm-wiab.git
```

2.Open the cp4mcm-wiab folder.
```
cd cp4mcm-wiab
```

3.Here you see 4 files. Change the file permission to be able to execute them.
```
chmod 755 *
```

4.Now, edit the 00-variables file.
```
vi 00-variables
```

5.Change the **CPK4MCM_FQDN** to point to your Cloud Pak for MCM console page.

  ![](images/1-change-variables.png)

6.Change the **NUMBER_LAB_USERS** with the number of users that you will have in your Workshop. We recommend a number between 1 and 30. The script will use this number to create the users on LDAP, Teams on CP4MCM, etc. **Save** your file.

  ![](images/2-change-variables.png)

  Great, now you are ready to run the Preparation scripts.

***

## Executing the Scripts

1.Let's execute the first script. This script will deploy an OpenLDAP instance for your Cloud Pak for Multicloud Manamement, with your *labusers*. In the middle of the script, you will be prompt to enter your CP4MCM admin and password.
```
./01-WiaB-mcm-ldap.sh
```

  ![](images/1-executing-script.png)

  Your labusers are **labuser1, labuser2, labuser3 ... labuserX** (where X is the number that you specified in the NUMBER_LAB_USERS variable) and their password are **passw0rd**.

2.Now that you have your LDAP with users. Let's use a script to register your *hub-cluster* in Cloud Pak for Multicloud Management. The hub-cluster will be added as a managed cluster, and all the lab users will use it as a second cluster. In the script, you will include some labels in the hub-cluster.
```
./02-WiaB-mcm-hub-registration.sh
```

  NOTE: If you receive the following error: unable to recognize "STDIN": no matches for kind "Endpoint" in version "multicloud.ibm.com/v1beta1". Execute the import command bellow again:

```
kubectl apply -f cluster-import-final.yaml
```


3.Let's execute the final script. This script will create the namespaces, teams and include the resources in Teams.
```
./03-WiaB-mcm-create-lab-teams.sh
```

  Great now your environment should be ready for your Workshop. Next section, you will just validate the environment.

***

## Validating the Environment

1.Back to the Cloud Pak for Multicloud Management Web Console. Log in with your admin user.

  ![](images/2-cluster-mgmt-img.png)

2.First, let's check the hub-cluster registration. Open the Cluster view. Click the hamburger **Menu** (1) and select **Automated Infrastructure -> Clusters** (2).

  ![](images/3-cluster-mgmt-img.png)

3.Here you should see the hub-cluster, check all the labels by clicking **Edit labels**.

  ![](images/2-validate-environment.png)

4.You should have the environment label and one targetX label for each lab user.

  ![](images/3-validate-environment.png)

5.Now, let's check the teams. Click the hamburger **Menu** (1) and select **Administer -> Identity and access** (2).

  ![](images/1-validate-environment.png)

6.You should see your new LDAP connection: ldap-slap (1). Open the **Teams** tab (2).

  ![](images/4-validate-environment.png)

7.If you see a team per each lab user and one group as member of your default team, you are ready for your workshop.

  ![](images/5-validate-environment.png)
